#@ load("@ytt:data", "data")
---
profile: build
ceip_policy_disclosed: true # Installation fails if this is set to 'false'
buildservice:
  kp_default_repository: #@ "{}/{}/build-service".format(data.values.tap.developer.registry.hostname,data.values.tap.developer.registry.project)
  kp_default_repository_username: #@ data.values.tap.developer.registry.username
  kp_default_repository_password: #@ data.values.tap.developer.registry.password
  tanzunet_username: #@ data.values.tap.registry.username
  tanzunet_password: #@ data.values.tap.registry.password
  enable_automatic_dependency_updates: true
  descriptor_name: full

supply_chain: testing_scanning

ootb_supply_chain_testing_scanning:
  registry:
    server: #@ data.values.tap.developer.registry.hostname
    repository: #@ data.values.tap.developer.registry.project_workload
  gitops:
    ssh_secret: "git-secret"
    server_address: #@ data.values.gitops_repository.server_address
    repository_owner: #@ data.values.gitops_repository.owner
    repository_name: gitops
    branch: main
    commit_strategy: pull_request
    pull_request:
      commit_branch: ""
      server_kind: #@ data.values.gitops_repository.type
      pull_request_title: Change ready for review
      pull_request_body: Generated by the TAP supply chain
scanning:
  metadataStore:
    url: ""
grype:
  namespace: #@ data.values.tap.developer.namespace
  targetImagePullSecret: dev-registry
  metadataStore:
    url: #@ "https://metadata-store.{}".format(data.values.tap.view.ingress.domain)
    authSecret:
      name: store-auth-token
      importFromNamespace: metadata-store-secrets
    caSecret:
      name: store-ca-cert
      importFromNamespace: metadata-store-secrets